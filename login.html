<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تسجيل الدخول</title>
  <style>
    body { font-family: Arial, sans-serif; background:#e0f7fa; display:flex; justify-content:center; align-items:center; height:100vh; }
    .box { background:#fff; padding:25px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); width:320px; text-align:center; }
    input, select, button { width:100%; margin:8px 0; padding:10px; border:1px solid #ccc; border-radius:8px; }
    button { background:#0288d1; color:#fff; border:none; cursor:pointer; }
    h2 { margin-bottom:15px; }
  </style>
</head>
<body>
<div class="box">
  <h2>تسجيل الدخول</h2>
  <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
  <input type="password" id="loginPassword" placeholder="كلمة المرور">
  <button id="loginBtn">دخول</button>

  <hr>
  <h2>إنشاء حساب</h2>
  <input type="email" id="signupEmail" placeholder="البريد الإلكتروني">
  <input type="password" id="signupPassword" placeholder="كلمة المرور">
  <select id="signupRole">
    <option value="agent">مندوب</option>
    <option value="supervisor">مشرف</option>
    <option value="admin">مدير</option>
  </select>
  <button id="signupBtn">تسجيل</button>
</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

  // 🔑 إعداد Supabase
  const supabase = createClient(
    "https://vkativialsvvbifhjrey.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZrYXRpdmlhbHN2dmJpZmhqcmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMDMxMDUsImV4cCI6MjA3MzY3OTEwNX0.iC-gq-uuXnK_1cJ_gYcjig8sr-bQfhqPk0SnuqbAeL0"
  )

  // تسجيل الدخول
  document.getElementById("loginBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("loginEmail").value
    const password = document.getElementById("loginPassword").value

    let { data, error } = await supabase
      .from("users")
      .select("*")
      .eq("email_or_phone", email)
      .eq("password", password)
      .single()

    if(error || !data){
      alert("بيانات الدخول غير صحيحة")
    } else {
      alert("مرحباً " + data.role)
      if(data.role === "admin") window.location = "admin.html"
      if(data.role === "supervisor") window.location = "supervisor.html"
      if(data.role === "agent") window.location = "agent.html"
    }
  })

  // إنشاء حساب
  document.getElementById("signupBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("signupEmail").value
    const password = document.getElementById("signupPassword").value
    const role = document.getElementById("signupRole").value

    const { error } = await supabase
      .from("users")
      .insert([{ email_or_phone: email, password, role }])

    if(error){
      alert("خطأ: " + error.message)
    } else {
      alert("تم التسجيل بنجاح، يمكنك تسجيل الدخول الآن")
    }
  })
</script>
</body>
</html>
