<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
  <style>
    body { font-family: Arial, sans-serif; background:#e0f7fa; display:flex; justify-content:center; align-items:center; height:100vh; }
    .box { background:#fff; padding:25px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.1); width:320px; text-align:center; }
    input, select, button { width:100%; margin:8px 0; padding:10px; border:1px solid #ccc; border-radius:8px; }
    button { background:#0288d1; color:#fff; border:none; cursor:pointer; }
    h2 { margin-bottom:15px; }
  </style>
</head>
<body>
<div class="box">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
  <input type="email" id="loginEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input type="password" id="loginPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>

  <hr>
  <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
  <input type="email" id="signupEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
  <input type="password" id="signupPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
  <select id="signupRole">
    <option value="agent">Ù…Ù†Ø¯ÙˆØ¨</option>
    <option value="supervisor">Ù…Ø´Ø±Ù</option>
    <option value="admin">Ù…Ø¯ÙŠØ±</option>
  </select>
  <button id="signupBtn">ØªØ³Ø¬ÙŠÙ„</button>
</div>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

  // ğŸ”‘ Ø¥Ø¹Ø¯Ø§Ø¯ Supabase
  const supabase = createClient(
    "https://vkativialsvvbifhjrey.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZrYXRpdmlhbHN2dmJpZmhqcmV5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxMDMxMDUsImV4cCI6MjA3MzY3OTEwNX0.iC-gq-uuXnK_1cJ_gYcjig8sr-bQfhqPk0SnuqbAeL0"
  )

  // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
  document.getElementById("loginBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("loginEmail").value
    const password = document.getElementById("loginPassword").value

    let { data, error } = await supabase
      .from("users")
      .select("*")
      .eq("email_or_phone", email)
      .eq("password", password)
      .single()

    if(error || !data){
      alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©")
    } else {
      alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ " + data.role)
      if(data.role === "admin") window.location = "admin.html"
      if(data.role === "supervisor") window.location = "supervisor.html"
      if(data.role === "agent") window.location = "agent.html"
    }
  })

  // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
  document.getElementById("signupBtn").addEventListener("click", async ()=>{
    const email = document.getElementById("signupEmail").value
    const password = document.getElementById("signupPassword").value
    const role = document.getElementById("signupRole").value

    const { error } = await supabase
      .from("users")
      .insert([{ email_or_phone: email, password, role }])

    if(error){
      alert("Ø®Ø·Ø£: " + error.message)
    } else {
      alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†")
    }
  })
</script>
</body>
</html>
