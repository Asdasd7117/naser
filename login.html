<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f4f4; display:flex; justify-content:center; align-items:center; height:100vh; }
    .container { background:white; padding:20px; border-radius:10px; width:300px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.2); }
    input, select { width:100%; padding:10px; margin:10px 0; border:1px solid #ccc; border-radius:5px; }
    button { width:100%; padding:10px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; }
    button:hover { background:#0056b3; }
    .toggle { color:#007bff; cursor:pointer; margin-top:10px; display:block; }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="formTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    
    <form id="loginForm">
      <input type="text" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
      <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </form>

    <form id="signupForm" style="display:none;">
      <input type="text" id="signupEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required>
      <input type="password" id="signupPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
      <select id="role" required>
        <option value="agent">Ù…Ù†Ø¯ÙˆØ¨</option>
        <option value="supervisor">Ù…Ø´Ø±Ù</option>
        <option value="admin">Ù…Ø¯ÙŠØ±</option>
      </select>
      <button type="submit">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
    </form>

    <span class="toggle" id="toggleForm">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ù‹Ø§</span>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

    // âœ… Ø¨ÙŠØ§Ù†Ø§Øª Supabase
    const SUPABASE_URL = "https://ncjxqfwsswwikedaffif.supabase.co"
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmZmlmIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcwNzAwODI2MSwiZXhwIjoyMDIyNTg0MjYxfQ.XXXX"

    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY)

    // ğŸ”„ ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
    const toggle = document.getElementById("toggleForm")
    const loginForm = document.getElementById("loginForm")
    const signupForm = document.getElementById("signupForm")
    const formTitle = document.getElementById("formTitle")

    toggle.addEventListener("click", () => {
      if (loginForm.style.display === "none") {
        loginForm.style.display = "block"
        signupForm.style.display = "none"
        formTitle.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
        toggle.textContent = "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø£Ù†Ø´Ø¦ ÙˆØ§Ø­Ø¯Ù‹Ø§"
      } else {
        loginForm.style.display = "none"
        signupForm.style.display = "block"
        formTitle.textContent = "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨"
        toggle.textContent = "Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„"
      }
    })

    // âœ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault()
      const email = document.getElementById("email").value
      const password = document.getElementById("password").value

      const { data, error } = await supabase
        .from("users")
        .select("id, role")
        .eq("email_or_phone", email)
        .eq("password", password)
        .single()

      if (error || !data) {
        alert("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„")
        return
      }

      // ğŸŸ¢ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      localStorage.setItem("agentId", data.id)
      localStorage.setItem("role", data.role)

      alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­")
      window.location.href = "dashboard.html"
    })

    // âœ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault()
      const email = document.getElementById("signupEmail").value
      const password = document.getElementById("signupPassword").value
      const role = document.getElementById("role").value

      const { data, error } = await supabase
        .from("users")
        .insert([{ email_or_phone: email, password, role }])
        .select("id, role")
        .single()

      if (error) {
        alert("âŒ Ù„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: " + error.message)
        return
      }

      // ğŸŸ¢ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      localStorage.setItem("agentId", data.id)
      localStorage.setItem("role", data.role)

      alert("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­")
      window.location.href = "dashboard.html"
    })
  </script>
</body>
</html>
