<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ğŸ“‹ ØµÙØ­Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Tahoma, sans-serif; background:#f5f5f5; padding:20px; }
    h2 { color:#333; }
    .card { background:white; padding:15px; margin:10px 0; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1); }
    .btn { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; }
    .btn-primary { background:#007bff; color:white; }
  </style>
</head>
<body>
  <h2>ğŸ“Œ Ù…Ù‡Ø§Ù…ÙŠ</h2>
  <div id="tasks"></div>

  <h2>ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
  <div id="notifications"></div>

  <h2>ğŸ“ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±</h2>
  <form id="reportForm">
    <textarea id="reportText" placeholder="Ø§ÙƒØªØ¨ ØªÙ‚Ø±ÙŠØ±Ùƒ Ù‡Ù†Ø§..." required></textarea><br>
    <button type="submit" class="btn btn-primary">Ø¥Ø±Ø³Ø§Ù„</button>
  </form>

  <script>
    // ğŸ”‘ Ø¨ÙŠØ§Ù†Ø§Øª Supabase
    const SUPABASE_URL = "https://ncjxqfwwswikedaffif.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmZmlmIiwicm9sZSI6InJvbGUiLCJpYXQiOjE3NTc4NDEwNzQsImV4cCI6MjA3MzQxNzA3NH0.lZCcHkDqW7Xhy_yP8P9dxY6U1KFeLrNJSugRMTi4JtU";

    // âœ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù‡Ù†Ø§: Ù†Ø³ØªØ®Ø¯Ù… createClient Ù…Ù† Ø§Ù„Ù…ÙƒØªØ¨Ø© ÙˆÙ„ÙŠØ³ Ù…Ù† Ù…ØªØºÙŠØ± Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // ğŸ“Œ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ (Ù…Ø¤Ù‚Øª)
    const currentUserId = "delegate-123"; 

    // ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…
    async function loadTasks() {
      const { data, error } = await client
        .from("tasks")
        .select("*")
        .eq("user_id", currentUserId);

      if (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…:", error.message);
        return;
      }

      const tasksDiv = document.getElementById("tasks");
      tasksDiv.innerHTML = "";
      data.forEach(task => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<b>${task.title || "Ù…Ù‡Ù…Ø©"}</b><br>${task.description || ""}`;
        tasksDiv.appendChild(card);
      });
    }

    // ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    async function loadNotifications() {
      const { data, error } = await client
        .from("notifications")
        .select("*")
        .order("created_at", { ascending: false });

      if (error) {
        console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª:", error.message);
        return;
      }

      const notiDiv = document.getElementById("notifications");
      notiDiv.innerHTML = "";
      data.forEach(noti => {
        const card = document.createElement("div");
        card.className = "card";
        card.textContent = noti.message || "Ø¥Ø´Ø¹Ø§Ø±";
        notiDiv.appendChild(card);
      });
    }

    // ğŸŸ¢ Ø¥Ø±Ø³Ø§Ù„ ØªÙ‚Ø±ÙŠØ±
    document.getElementById("reportForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const reportText = document.getElementById("reportText").value;

      const { error } = await client
        .from("reports")
        .insert([{ text: reportText, user_id: currentUserId }]);

      if (error) {
        console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:", error.message);
        alert("ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±!");
      } else {
        alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!");
        document.getElementById("reportForm").reset();
      }
    });

    // ğŸš€ ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    loadTasks();
    loadNotifications();
  </script>
</body>
</html>
