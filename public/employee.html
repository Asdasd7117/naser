<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة المندوب</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body { font-family: Arial; background:#f4f6f9; margin:0; }
header { background:#e67e22; color:white; padding:15px; text-align:center; position:relative; }
nav { background:#2c3e50; color:white; display:flex; justify-content:space-around; padding:10px; }
nav button { background:none; border:none; color:white; font-size:16px; cursor:pointer; }
nav button:hover { text-decoration:underline; }
.container { padding:20px; }
.card { background:white; border-radius:8px; padding:15px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
h3 { margin-top:0; color:#2c3e50; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table th, table td { border:1px solid #ddd; padding:8px; text-align:center; }
table th { background:#ecf0f1; }
input, textarea { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
button.action { background:#3498db; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer; margin-top:5px; }
button.action:hover { background:#2980b9; }
.lang-btn { position:absolute; top:15px; left:15px; background:#2ecc71; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; color:white; }
</style>
</head>
<body>
<header>
<h2 id="title">لوحة المندوب</h2>
<button class="lang-btn" onclick="toggleLang()">🇸🇦/🇬🇧</button>
</header>

<nav>
<button onclick="showSection('tasks')">📝 <span id="navTasks">المهام</span></button>
<button onclick="showSection('report')">📄 <span id="navReport">رفع التقرير</span></button>
<button onclick="showSection('map')">🗺 <span id="navMap">الخريطة</span></button>
<button onclick="showSection('noti')">🔔 <span id="navNoti">الإشعارات</span></button>
</nav>

<div class="container">
<div class="card" id="tasks">
<h3 id="tasksTitle">المهام اليومية</h3>
<table>
<thead>
<tr><th>اسم العميل</th><th>العنوان</th><th>وقت الزيارة</th><th>الحالة</th><th>تحديث</th></tr>
</thead>
<tbody id="tasksList"></tbody>
</table>
</div>

<div class="card" id="report" style="display:none;">
<h3 id="reportTitle">رفع التقرير</h3>
<textarea id="notes" placeholder="الملاحظات"></textarea>
<input type="file" id="images" multiple>
<input type="text" id="signature" placeholder="توقيع العميل">
<button class="action" onclick="submitReport()">إرسال التقرير</button>
</div>

<div class="card" id="map" style="display:none;">
<h3 id="mapTitle">موقعك الحالي</h3>
<p>📍 سيتم عرض موقعك ونقاط زيارات العملاء هنا (Google Maps API لاحقًا)</p>
</div>

<div class="card" id="noti" style="display:none;">
<h3 id="notiTitle">الإشعارات</h3>
<ul id="notiList"></ul>
</div>
</div>

<script>
const SUPABASE_URL="https://ncjxqfqwswwikedaffif.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmZmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDEwNzQsImV4cCI6MjA3MzQxNzA3NH0.4G54968qAHyePjq9_ufSCSA1fHzx5XHFzOAqGKmVW18";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let lang="ar";
const texts={
ar:{title:"لوحة المندوب",nav:{tasks:"المهام",report:"رفع التقرير",map:"الخريطة",noti:"الإشعارات"},tasks:"المهام اليومية",report:"رفع التقرير",map:"موقعك الحالي",noti:"الإشعارات",submitReport:"إرسال التقرير",notes:"الملاحظات",signature:"توقيع العميل"},
en:{title:"Agent Dashboard",nav:{tasks:"Tasks",report:"Upload Report",map:"Map",noti:"Notifications"},tasks:"Daily Tasks",report:"Upload Report",map:"Your Location",noti:"Notifications",submitReport:"Submit Report",notes:"Notes",signature:"Client Signature"}
};

function toggleLang(){
lang=lang==="ar"?"en":"ar";
document.documentElement.lang=lang;
document.documentElement.dir=lang==="ar"?"rtl":"ltr";
document.getElementById("title").innerText=texts[lang].title;
document.getElementById("navTasks").innerText=texts[lang].nav.tasks;
document.getElementById("navReport").innerText=texts[lang].nav.report;
document.getElementById("navMap").innerText=texts[lang].nav.map;
document.getElementById("navNoti").innerText=texts[lang].nav.noti;
document.getElementById("tasksTitle").innerText=texts[lang].tasks;
document.getElementById("reportTitle").innerText=texts[lang].report;
document.getElementById("mapTitle").innerText=texts[lang].map;
document.getElementById("notiTitle").innerText=texts[lang].noti;
document.querySelector("#report textarea").placeholder=texts[lang].notes;
document.querySelector("#report input[type=text]").placeholder=texts[lang].signature;
document.querySelector("#report button").innerText=texts[lang].submitReport;
}

function showSection(section){
document.querySelectorAll(".card").forEach(c=>c.style.display="none");
document.getElementById(section).style.display="block";
}

async function loadTasks(){
const {data,error}=await supabase.from("tasks").select("*").eq("agent_id",1); // استبدل 1 بـ ID المندوب
const tbody=document.getElementById("tasksList");
tbody.innerHTML="";
if(data){
data.forEach(t=>{
const tr=document.createElement("tr");
tr.innerHTML=`<td>${t.client_name}</td><td>${t.address}</td><td>${t.visit_time}</td><td>${t.status}</td><td><button class="action" onclick="updateTask(${t.id})">✓ تحديث</button></td>`;
tbody.appendChild(tr);
});
}
}

async function updateTask(taskId){
await supabase.from("tasks").update({status:"مكتملة"}).eq("id",taskId);
loadTasks();
}

async function submitReport(){
const notes=document.getElementById("notes").value;
const signature=document.getElementById("signature").value;
await supabase.from("reports").insert([{agent_id:1,notes,signature,date:new Date()}]);
alert(lang==="ar"?"تم إرسال التقرير!":"Report submitted!");
document.getElementById("notes").value="";
document.getElementById("signature").value="";
loadTasks();
}

async function loadNotifications(){
const {data}=await supabase.from("notifications").select("*").eq("agent_id",1);
const ul=document.getElementById("notiList"); ul.innerHTML="";
if(data) data.forEach(n=>{const li=document.createElement("li"); li.innerText=n.message; ul.appendChild(li);});
}

// تحميل البيانات عند فتح الصفحة
loadTasks(); loadNotifications();
</script>
</body>
</html>
