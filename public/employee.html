<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body { font-family: Arial; background:#f4f6f9; margin:0; }
header { background:#e67e22; color:white; padding:15px; text-align:center; position:relative; }
nav { background:#2c3e50; color:white; display:flex; justify-content:space-around; padding:10px; }
nav button { background:none; border:none; color:white; font-size:16px; cursor:pointer; }
nav button:hover { text-decoration:underline; }
.container { padding:20px; }
.card { background:white; border-radius:8px; padding:15px; margin-bottom:20px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
h3 { margin-top:0; color:#2c3e50; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
table th, table td { border:1px solid #ddd; padding:8px; text-align:center; }
table th { background:#ecf0f1; }
input, textarea { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:1px solid #ccc; }
button.action { background:#3498db; color:white; border:none; padding:10px; border-radius:6px; cursor:pointer; margin-top:5px; }
button.action:hover { background:#2980b9; }
.lang-btn { position:absolute; top:15px; left:15px; background:#2ecc71; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; color:white; }
</style>
</head>
<body>
<header>
<h2 id="title">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h2>
<button class="lang-btn" onclick="toggleLang()">ğŸ‡¸ğŸ‡¦/ğŸ‡¬ğŸ‡§</button>
</header>

<nav>
<button onclick="showSection('tasks')">ğŸ“ <span id="navTasks">Ø§Ù„Ù…Ù‡Ø§Ù…</span></button>
<button onclick="showSection('report')">ğŸ“„ <span id="navReport">Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</span></button>
<button onclick="showSection('map')">ğŸ—º <span id="navMap">Ø§Ù„Ø®Ø±ÙŠØ·Ø©</span></button>
<button onclick="showSection('noti')">ğŸ”” <span id="navNoti">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span></button>
</nav>

<div class="container">
<div class="card" id="tasks">
<h3 id="tasksTitle">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
<table>
<thead>
<tr><th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>ÙˆÙ‚Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>ØªØ­Ø¯ÙŠØ«</th></tr>
</thead>
<tbody id="tasksList"></tbody>
</table>
</div>

<div class="card" id="report" style="display:none;">
<h3 id="reportTitle">Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</h3>
<textarea id="notes" placeholder="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
<input type="file" id="images" multiple>
<input type="text" id="signature" placeholder="ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„">
<button class="action" onclick="submitReport()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
</div>

<div class="card" id="map" style="display:none;">
<h3 id="mapTitle">Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
<p>ğŸ“ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆÙ†Ù‚Ø§Ø· Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ù‡Ù†Ø§ (Google Maps API Ù„Ø§Ø­Ù‚Ù‹Ø§)</p>
</div>

<div class="card" id="noti" style="display:none;">
<h3 id="notiTitle">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
<ul id="notiList"></ul>
</div>
</div>

<script>
const SUPABASE_URL="https://ncjxqfqwswwikedaffif.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmZmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDEwNzQsImV4cCI6MjA3MzQxNzA3NH0.4G54968qAHyePjq9_ufSCSA1fHzx5XHFzOAqGKmVW18";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let lang="ar";
const texts={
ar:{title:"Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨",nav:{tasks:"Ø§Ù„Ù…Ù‡Ø§Ù…",report:"Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",map:"Ø§Ù„Ø®Ø±ÙŠØ·Ø©",noti:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª"},tasks:"Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©",report:"Ø±ÙØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",map:"Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ",noti:"Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª",submitReport:"Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±",notes:"Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª",signature:"ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„"},
en:{title:"Agent Dashboard",nav:{tasks:"Tasks",report:"Upload Report",map:"Map",noti:"Notifications"},tasks:"Daily Tasks",report:"Upload Report",map:"Your Location",noti:"Notifications",submitReport:"Submit Report",notes:"Notes",signature:"Client Signature"}
};

function toggleLang(){
lang=lang==="ar"?"en":"ar";
document.documentElement.lang=lang;
document.documentElement.dir=lang==="ar"?"rtl":"ltr";
document.getElementById("title").innerText=texts[lang].title;
document.getElementById("navTasks").innerText=texts[lang].nav.tasks;
document.getElementById("navReport").innerText=texts[lang].nav.report;
document.getElementById("navMap").innerText=texts[lang].nav.map;
document.getElementById("navNoti").innerText=texts[lang].nav.noti;
document.getElementById("tasksTitle").innerText=texts[lang].tasks;
document.getElementById("reportTitle").innerText=texts[lang].report;
document.getElementById("mapTitle").innerText=texts[lang].map;
document.getElementById("notiTitle").innerText=texts[lang].noti;
document.querySelector("#report textarea").placeholder=texts[lang].notes;
document.querySelector("#report input[type=text]").placeholder=texts[lang].signature;
document.querySelector("#report button").innerText=texts[lang].submitReport;
}

function showSection(section){
document.querySelectorAll(".card").forEach(c=>c.style.display="none");
document.getElementById(section).style.display="block";
}

async function loadTasks(){
const {data,error}=await supabase.from("tasks").select("*").eq("agent_id",1); // Ø§Ø³ØªØ¨Ø¯Ù„ 1 Ø¨Ù€ ID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨
const tbody=document.getElementById("tasksList");
tbody.innerHTML="";
if(data){
data.forEach(t=>{
const tr=document.createElement("tr");
tr.innerHTML=`<td>${t.client_name}</td><td>${t.address}</td><td>${t.visit_time}</td><td>${t.status}</td><td><button class="action" onclick="updateTask(${t.id})">âœ“ ØªØ­Ø¯ÙŠØ«</button></td>`;
tbody.appendChild(tr);
});
}
}

async function updateTask(taskId){
await supabase.from("tasks").update({status:"Ù…ÙƒØªÙ…Ù„Ø©"}).eq("id",taskId);
loadTasks();
}

async function submitReport(){
const notes=document.getElementById("notes").value;
const signature=document.getElementById("signature").value;
await supabase.from("reports").insert([{agent_id:1,notes,signature,date:new Date()}]);
alert(lang==="ar"?"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±!":"Report submitted!");
document.getElementById("notes").value="";
document.getElementById("signature").value="";
loadTasks();
}

async function loadNotifications(){
const {data}=await supabase.from("notifications").select("*").eq("agent_id",1);
const ul=document.getElementById("notiList"); ul.innerHTML="";
if(data) data.forEach(n=>{const li=document.createElement("li"); li.innerText=n.message; ul.appendChild(li);});
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadTasks(); loadNotifications();
</script>
</body>
</html>
