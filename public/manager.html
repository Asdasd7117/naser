<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0;}
header{background:#8e44ad;color:white;padding:15px;text-align:center;position:relative;}
nav{background:#2c3e50;color:white;display:flex;justify-content:space-around;padding:10px;}
nav button{background:none;border:none;color:white;font-size:16px;cursor:pointer;}
nav button:hover{text-decoration:underline;}
.container{padding:20px;}
.card{background:white;border-radius:8px;padding:15px;margin-bottom:20px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
h3{margin-top:0;color:#2c3e50;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table th,table td{border:1px solid #ddd;padding:8px;text-align:center;}
table th{background:#ecf0f1;}
.lang-btn{position:absolute;top:15px;left:15px;background:#2980b9;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;color:white;}
button.action{background:#3498db;color:white;border:none;padding:10px;border-radius:6px;cursor:pointer;margin-top:5px;}
button.action:hover{background:#2980b9;}
</style>
</head>
<body>
<header>
<h2 id="title">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</h2>
<button class="lang-btn" onclick="toggleLang()">ğŸ‡¸ğŸ‡¦/ğŸ‡¬ğŸ‡§</button>
</header>

<nav>
<button onclick="showSection('analytics')">ğŸ“Š <span id="navAnalytics">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</span></button>
<button onclick="showSection('attendance')">â° <span id="navAttendance">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</span></button>
<button onclick="showSection('control')">âš™ï¸ <span id="navControl">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span></button>
</nav>

<div class="container">
<!-- Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª -->
<div class="card" id="analytics">
<h3 id="analyticsTitle">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h3>
<table>
<thead><tr><th>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th><th>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</th><th>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¤Ø¬Ù„Ø©</th></tr></thead>
<tbody id="analyticsList"></tbody>
</table>
</div>

<!-- Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù -->
<div class="card" id="attendance" style="display:none;">
<h3 id="attendanceTitle">Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h3>
<table>
<thead><tr><th>Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</th><th>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</th></tr></thead>
<tbody id="attendanceList"></tbody>
</table>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
<div class="card" id="control" style="display:none;">
<h3 id="controlTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
<button class="action" onclick="addTask()">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
<button class="action" onclick="editAgent()">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¯ÙˆØ¨</button>
<button class="action" onclick="addAgent('employee')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨</button>
<button class="action" onclick="addAgent('supervisor')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù</button>
<button class="action" onclick="deleteAgent()">ğŸ—‘ï¸ Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…</button>
</div>
</div>

<script>
const SUPABASE_URL="https://ncjxqfqwswwikedaffif.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDEwNzQsImV4cCI6MjA3MzQxNzA3NH0.4G54968qAHyePjq9_ufSCSA1fHzx5XHFzOAqGKmVW18";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let lang="ar";
const texts={
ar:{title:"Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±",nav:{analytics:"Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª",attendance:"Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù",control:"Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"},analytics:"Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª",attendance:"Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù",control:"Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"},
en:{title:"Admin Dashboard",nav:{analytics:"Analytics",attendance:"Attendance",control:"Control Panel"},analytics:"Analytics",attendance:"Attendance",control:"Control Panel"}
};

function toggleLang(){
lang=lang==="ar"?"en":"ar";
document.documentElement.lang=lang;
document.documentElement.dir=lang==="ar"?"rtl":"ltr";
document.getElementById("title").innerText=texts[lang].title;
document.getElementById("navAnalytics").innerText=texts[lang].nav.analytics;
document.getElementById("navAttendance").innerText=texts[lang].nav.attendance;
document.getElementById("navControl").innerText=texts[lang].nav.control;
document.getElementById("analyticsTitle").innerText=texts[lang].analytics;
document.getElementById("attendanceTitle").innerText=texts[lang].attendance;
document.getElementById("controlTitle").innerText=texts[lang].control;
}

function showSection(section){
document.querySelectorAll(".card").forEach(c=>c.style.display="none");
document.getElementById(section).style.display="block";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª
async function loadAnalytics(){
const {data: tasks}=await supabase.from("tasks").select("*");
const {data: users}=await supabase.from("users").select("*").eq("role","employee");
const tbody=document.getElementById("analyticsList");
tbody.innerHTML="";
if(tasks && users){
users.forEach(u=>{
let completed=tasks.filter(t=>t.agent_id===u.id && t.status==="Ù…ÙƒØªÙ…Ù„Ø©").length;
let delayed=tasks.filter(t=>t.agent_id===u.id && t.status==="Ù…Ø¤Ø¬Ù„Ø©").length;
const tr=document.createElement("tr");
tr.innerHTML=`<td>${u.name}</td><td>${completed}</td><td>${delayed}</td>`;
tbody.appendChild(tr);
});
}
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù
async function loadAttendance(){
const {data: attendances}=await supabase.from("attendance").select("*");
const {data: users}=await supabase.from("users").select("*").eq("role","employee");
const tbody=document.getElementById("attendanceList");
tbody.innerHTML="";
if(attendances && users){
users.forEach(u=>{
let record=attendances.find(a=>a.agent_id===u.id);
let hours=record?record.hours_worked:0;
const tr=document.createElement("tr");
tr.innerHTML=`<td>${u.name}</td><td>${hours} Ø³Ø§Ø¹Ø©</td>`;
tbody.appendChild(tr);
});
}
}

// Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
async function addTask(){
let agentId=prompt("Ø§Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨:");
let client=prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:");
let address=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:");
let visitTime=prompt("Ø§Ø¯Ø®Ù„ ÙˆÙ‚Øª Ø§Ù„Ø²ÙŠØ§Ø±Ø©:");
if(agentId && client && address && visitTime){
await supabase.from("tasks").insert([{agent_id:parseInt(agentId),client_name:client,address:address,visit_time:visitTime,status:"Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°"}]);
alert(lang==="ar"?"ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©!":"Task added!");
loadAnalytics();
}
}

// Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù†Ø¯ÙˆØ¨
async function editAgent(){
let agentId=prompt("Ø§Ø¯Ø®Ù„ ID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ù„ØªØ¹Ø¯ÙŠÙ„Ù‡:");
let name=prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
let location=prompt("Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
if(agentId){
await supabase.from("users").update({name,location}).eq("id",parseInt(agentId));
alert(lang==="ar"?"ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨!":"Agent updated!");
loadAnalytics(); loadAttendance();
}
}

// Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ù†Ø¯ÙˆØ¨ Ø£Ùˆ Ù…Ø´Ø±Ù)
async function addAgent(role){
let name=prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… " + (role==="employee" ? "Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨" : "Ø§Ù„Ù…Ø´Ø±Ù") + ":");
let email=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:");
let password=prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
if(name && email && password){
const { error } = await supabase.from("users").insert([{ name, email, password, role }]);
if(error){
alert("Ø®Ø·Ø£: " + error.message);
}else{
alert(lang==="ar" ? "ØªÙ… Ø¥Ø¶Ø§ÙØ© " + (role==="employee" ? "Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨!" : "Ø§Ù„Ù…Ø´Ø±Ù!") : (role==="employee" ? "Employee added!" : "Supervisor added!"));
loadAnalytics(); loadAttendance();
}
}
}

// Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…: Ø­Ø°Ù Ù…Ø³ØªØ®Ø¯Ù…
async function deleteAgent(){
let email=prompt("Ø§Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡:");
if(email){
const { error } = await supabase.from("users").delete().eq("email",email);
if(error){
alert("Ø®Ø·Ø£: " + error.message);
}else{
alert(lang==="ar"?"ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!":"User deleted!");
loadAnalytics(); loadAttendance();
}
}
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadAnalytics(); loadAttendance();
</script>
</body>
</html>
