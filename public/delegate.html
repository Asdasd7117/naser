
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>المندوب</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/lang.js"></script>
<script src="js/app.js"></script>
<script src="js/map.js"></script>
<style>
body{font-family:sans-serif;background:#f0f8ff;color:#003366;}
button{background:#008CBA;color:white;padding:8px 12px;border:none;border-radius:5px;cursor:pointer;}
textarea{width:100%;height:80px;}
#tasks-list div{margin-bottom:10px;padding:5px;border:1px solid #ccc;border-radius:5px;}
</style>
</head>
<body>
<h1 data-translate="tasks_title">المهام اليومية</h1>
<div id="tasks-list"></div>
<h2 data-translate="report_title">رفع التقرير</h2>
<textarea id="report-notes" placeholder="اكتب ملاحظات"></textarea>
<input type="file" id="report-images" multiple>
<input type="file" id="report-signature">
<button onclick="submitDelegateReport()" data-translate="send_report">إرسال التقرير</button>
<div id="map" style="width:100%;height:300px;margin-top:10px;"></div>
<button onclick="toggleLanguage()">عربي/English</button>
<script>
async function loadTasks(){
  const tasks = await getTasks();
  const container = document.getElementById('tasks-list');
  container.innerHTML = '';
  tasks.forEach(t=>{
    const div = document.createElement('div');
    div.innerHTML = `<b>${t.client}</b> - ${t.address} - ${t.time} - ${t.status} <button onclick="updateTaskStatus('${t.id}')">تحديث الحالة</button>`;
    container.appendChild(div);
  });
}
async function updateTaskStatus(id){
  const tasks = await getTasks();
  const task = tasks.find(t=>t.id===id);
  if(task){ task.status = "مكتملة"; await updateTask(task); loadTasks(); }
}
async function submitDelegateReport(){
  const notes = document.getElementById('report-notes').value;
  const images = Array.from(document.getElementById('report-images').files);
  const signature = document.getElementById('report-signature').files[0];
  await sendReport(notes, images, signature);
}
loadTasks();
initMap();
</script>
</body>
</html>
