<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شاشة المندوب</title>
<link rel="stylesheet" href="css/style.css">
<script src="js/app.js" defer></script>
<script defer>
// ===================== الترجمات =====================
const translations = {
  ar: {
    tasks_title: "المهام اليومية",
    report_title: "رفع التقرير",
    report_notes: "أدخل الملاحظات",
    send_report: "إرسال التقرير",
    map_title: "الخريطة",
    update_location: "تحديث الموقع",
    notifications_title: "الإشعارات",
    tasks_tab: "المهام",
    report_tab: "التقرير",
    map_tab: "الخريطة",
    notifications_tab: "الإشعارات",
    toggle_lang: "عربي / English",
    delegate_name: "أحمد علي"
  },
  en: {
    tasks_title: "Daily Tasks",
    report_title: "Submit Report",
    report_notes: "Write your notes",
    send_report: "Send Report",
    map_title: "Map",
    update_location: "Update Location",
    notifications_title: "Notifications",
    tasks_tab: "Tasks",
    report_tab: "Report",
    map_tab: "Map",
    notifications_tab: "Notifications",
    toggle_lang: "Arabic / English",
    delegate_name: "Ahmed Ali"
  }
};

// ===================== اللغة =====================
function toggleLanguage() {
  const current = document.documentElement.lang;
  const newLang = current === "ar" ? "en" : "ar";
  document.documentElement.lang = newLang;
  document.documentElement.dir = newLang === "ar" ? "rtl" : "ltr";
  applyTranslations(newLang);
}

function applyTranslations(lang) {
  document.querySelectorAll("[data-translate]").forEach(el => {
    const key = el.getAttribute("data-translate");
    if (translations[lang][key]) el.innerText = translations[lang][key];
  });
  updateDelegateHeader();
}

// ===================== اسم المندوب + الساعة =====================
function updateDelegateHeader() {
  const now = new Date().toLocaleTimeString("ar-EG", {
    hour: "2-digit", minute: "2-digit", hour12: false, timeZone: "Africa/Cairo"
  });
  const name = translations[document.documentElement.lang]["delegate_name"];
  document.getElementById("delegate-name").innerText = `👤 ${name} | 🕒 ${now}`;
}
setInterval(updateDelegateHeader, 60000);

// ===================== مصفوفة المهام =====================
let tasks = [
  { client: "شركة أبجد", address: "القاهرة", time: "10:00 صباحًا", status: "قيد التنفيذ" },
  { client: "مؤسسة ألف", address: "الإسكندرية", time: "11:00", status: "مؤجلة" }
];

// ===================== عرض المهام =====================
function loadTasks() {
  const list = document.getElementById("tasks-list");
  list.innerHTML = "";
  tasks.forEach((t, idx) => {
    const div = document.createElement("div");
    div.className = "task-card";
    div.innerHTML = `
      <strong>العميل:</strong> ${t.client}<br>
      <strong>العنوان:</strong> ${t.address}<br>
      <strong>وقت الزيارة:</strong> ${t.time}<br>
      <label>الحالة:
        <select data-index="${idx}">
          <option value="قيد التنفيذ" ${t.status==="قيد التنفيذ"?"selected":""}>قيد التنفيذ</option>
          <option value="مكتملة" ${t.status==="مكتملة"?"selected":""}>مكتملة</option>
          <option value="مؤجلة" ${t.status==="مؤجلة"?"selected":""}>مؤجلة</option>
        </select>
      </label>
    `;
    const select = div.querySelector("select");
    select.addEventListener("change", function() {
      tasks[this.dataset.index].status = this.value;
      alert(`تم تحديث حالة المهمة إلى: ${this.value}`);
    });
    list.appendChild(div);
  });
}

// ===================== رفع التقرير =====================
function submitDelegateReport() {
  const notes = document.getElementById('report-notes').value;
  alert(`تم إرسال التقرير ✅\nالملاحظات: ${notes}`);
  document.getElementById('report-notes').value = "";
}

// ===================== الإشعارات =====================
function loadNotifications() {
  const notifs = [
    "تذكير: زيارة شركة أبجد الساعة 10:00 صباحًا",
    "تنبيه: تأخرت عن مهمة مؤسسة ألف بـ 15 دقيقة"
  ];
  const ul = document.getElementById("notifications-list");
  ul.innerHTML = "";
  notifs.forEach(n => {
    const li = document.createElement("li");
    li.textContent = n;
    ul.appendChild(li);
  });
}

// ===================== الخريطة =====================
function initMap() {
  document.getElementById("map-container").innerHTML = "خريطة افتراضية (يمكن ربط Google Maps API)";
}
function updateLocation() {
  alert("تم تحديث الموقع ✅");
}

// ===================== التحكم في الأقسام =====================
function showSection(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.querySelectorAll(".bottom-nav button").forEach(b => b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.getElementById("btn-" + id).classList.add("active");
}

// ===================== عند تحميل الصفحة =====================
window.onload = function(){
  applyTranslations(document.documentElement.lang);
  showSection('tasks');
  loadTasks();
  loadNotifications();
  initMap();
  updateDelegateHeader();
};
</script>
</head>
<body>

<!-- الهيدر -->
<header class="app-header">
  <h1 id="delegate-name"></h1>
</header>

<!-- شاشات المندوب -->
<section id="tasks" class="screen">
  <h2 data-translate="tasks_title">المهام اليومية</h2>
  <div id="tasks-list"></div>
</section>

<section id="report" class="screen">
  <h2 data-translate="report_title">رفع التقرير</h2>
  <textarea id="report-notes" placeholder="" data-translate="report_notes"></textarea><br>
  <input type="file" id="report-images" multiple><br>
  <input type="file" id="report-signature"><br>
  <button onclick="submitDelegateReport()" data-translate="send_report">إرسال التقرير</button>
</section>

<section id="map" class="screen">
  <h2 data-translate="map_title">الخريطة</h2>
  <div id="map-container"></div>
  <button onclick="updateLocation()" data-translate="update_location">تحديث الموقع</button>
</section>

<section id="notifications" class="screen">
  <h2 data-translate="notifications_title">الإشعارات</h2>
  <ul id="notifications-list"></ul>
</section>

<!-- شريط التنقل -->
<nav class="bottom-nav">
  <button id="btn-tasks" onclick="showSection('tasks')" data-translate="tasks_tab">المهام</button>
  <button id="btn-report" onclick="showSection('report')" data-translate="report_tab">التقرير</button>
  <button id="btn-map" onclick="showSection('map')" data-translate="map_tab">الخريطة</button>
  <button id="btn-notifications" onclick="showSection('notifications')" data-translate="notifications_tab">الإشعارات</button>
</nav>

<!-- زر اللغة -->
<button class="lang-btn" onclick="toggleLanguage()" data-translate="toggle_lang">عربي/English</button>

</body>
</html>
