<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
  <header>
    <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù / Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h1>
    <nav>
      <button onclick="showSection('delegates')">ğŸ‘¥ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</button>
      <button onclick="showSection('map')">ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</button>
      <button onclick="showSection('reports')">ğŸ“‘ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
      <button onclick="showSection('notifications')">ğŸ”” Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
    </nav>
  </header>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ† -->
  <section id="delegates" class="page">
    <h2>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†</h2>
    <div id="delegateList" class="card-container"></div>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
  <section id="map" class="page" style="display:none;">
    <h2>Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h2>
    <select id="delegateSelect" onchange="filterMap()">
      <option value="all">Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
    </select>
    <div id="mapView" style="width:100%;height:400px;background:#eee;text-align:center;line-height:400px;">
      ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
    </div>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
  <section id="reports" class="page" style="display:none;">
    <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
    <div id="reportList" class="card-container"></div>
  </section>

  <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª -->
  <section id="notifications" class="page" style="display:none;">
    <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
    <ul id="notificationsList"></ul>
  </section>

  <script>
    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    function showSection(id) {
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†
    async function loadDelegates() {
      const res = await axios.get('/api/users');
      const delegates = res.data.filter(u => u.role === 'delegate');
      const container = document.getElementById('delegateList');
      const select = document.getElementById('delegateSelect');
      container.innerHTML = '';
      delegates.forEach(d => {
        // Ø¨Ø·Ø§Ù‚Ø© Ù…Ù†Ø¯ÙˆØ¨
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${d.user}</h3>
          <p>ğŸ“± ${d.phone}</p>
          <p>Ø§Ù„Ø­Ø§Ù„Ø©: <span class="status active">Ù†Ø´Ø·</span></p>
          <button onclick="showOnMap('${d.user}')">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
        `;
        container.appendChild(card);

        // Ø¥Ø¶Ø§ÙØ© Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const opt = document.createElement('option');
        opt.value = d.user;
        opt.textContent = d.user;
        select.appendChild(opt);
      });
    }

    // Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
    async function loadReports() {
      const res = await axios.get('/api/reports');
      const reports = res.data;
      const container = document.getElementById('reportList');
      container.innerHTML = '';
      reports.forEach(r => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>ğŸ“ ØªÙ‚Ø±ÙŠØ± ${r.delegate}</h3>
          <p><b>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</b> ${r.notes}</p>
          ${r.images.map(img => `<img src="${img}" style="max-width:100px;">`).join('')}
          ${r.signature ? `<p><b>ØªÙˆÙ‚ÙŠØ¹:</b><img src="${r.signature}" style="max-width:100px;"></p>` : ''}
          <textarea placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø´Ø±Ù"></textarea>
          <button>ğŸ’¾ Ø­ÙØ¸</button>
        `;
        container.appendChild(card);
      });
    }

    // Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
    function loadNotifications() {
      const notifs = [
        "ğŸš¨ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø£Ø­Ù…Ø¯ ØªØ£Ø®Ø± Ø¹Ù† Ø§Ù„Ù…Ù‡Ù…Ø© 20 Ø¯Ù‚ÙŠÙ‚Ø©",
        "âœ… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø³Ø§Ù…ÙŠ Ø£ÙƒÙ…Ù„ Ù…Ù‡Ù…Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ X"
      ];
      const list = document.getElementById('notificationsList');
      list.innerHTML = '';
      notifs.forEach(n => {
        const li = document.createElement('li');
        li.textContent = n;
        list.appendChild(li);
      });
    }

    // Ø¹Ø±Ø¶ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    function showOnMap(user) {
      document.getElementById('mapView').innerHTML = `ğŸ“ Ù…ÙˆÙ‚Ø¹ ${user}`;
      showSection('map');
    }

    function filterMap() {
      const sel = document.getElementById('delegateSelect').value;
      document.getElementById('mapView').innerHTML =
        sel === 'all' ? "ğŸ—ºï¸ Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ÙŠÙ†" : `ğŸ“ Ø¹Ø±Ø¶ ${sel}`;
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    loadDelegates();
    loadReports();
    loadNotifications();
  </script>
</body>
</html>
