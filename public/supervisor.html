<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة المشرف</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0;}
header{background:#27ae60;color:white;padding:15px;text-align:center;position:relative;}
nav{background:#2c3e50;color:white;display:flex;justify-content:space-around;padding:10px;}
nav button{background:none;border:none;color:white;font-size:16px;cursor:pointer;}
nav button:hover{text-decoration:underline;}
.container{padding:20px;}
.card{background:white;border-radius:8px;padding:15px;margin-bottom:20px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
h3{margin-top:0;color:#2c3e50;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
table th,table td{border:1px solid #ddd;padding:8px;text-align:center;}
table th{background:#ecf0f1;}
.lang-btn{position:absolute;top:15px;left:15px;background:#2980b9;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;color:white;}
</style>
</head>
<body>
<header>
<h2 id="title">لوحة المشرف</h2>
<button class="lang-btn" onclick="toggleLang()">🇸🇦/🇬🇧</button>
</header>

<nav>
<button onclick="showSection('agents')">👥 <span id="navAgents">المندوبين</span></button>
<button onclick="showSection('map')">🗺 <span id="navMap">الخريطة</span></button>
<button onclick="showSection('reports')">📄 <span id="navReports">التقارير</span></button>
<button onclick="showSection('noti')">🔔 <span id="navNoti">الإشعارات</span></button>
</nav>

<div class="container">
<div class="card" id="agents">
<h3 id="agentsTitle">لوحة متابعة المندوبين</h3>
<table>
<thead><tr><th>الاسم</th><th>الموقع</th><th>عدد المهام</th><th>الحالة</th></tr></thead>
<tbody id="agentsList"></tbody>
</table>
</div>

<div class="card" id="map" style="display:none;">
<h3 id="mapTitle">خريطة المندوبين</h3>
<p>📍 سيتم عرض مواقع المندوبين هنا (Google Maps API لاحقًا)</p>
</div>

<div class="card" id="reports" style="display:none;">
<h3 id="reportsTitle">مراجعة التقارير</h3>
<table>
<thead><tr><th>المندوب</th><th>التقرير</th><th>التاريخ</th></tr></thead>
<tbody id="reportsList"></tbody>
</table>
</div>

<div class="card" id="noti" style="display:none;">
<h3 id="notiTitle">الإشعارات</h3>
<ul id="notiList"></ul>
</div>
</div>

<script>
const SUPABASE_URL="https://ncjxqfqwswwikedaffif.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5janhxZnF3c3d3aWtlZGFmZmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4NDEwNzQsImV4cCI6MjA3MzQxNzA3NH0.4G54968qAHyePjq9_ufSCSA1fHzx5XHFzOAqGKmVW18";
const supabase=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

let lang="ar";
const texts={
ar:{title:"لوحة المشرف",nav:{agents:"المندوبين",map:"الخريطة",reports:"التقارير",noti:"الإشعارات"},agents:"لوحة متابعة المندوبين",map:"خريطة المندوبين",reports:"مراجعة التقارير",noti:"الإشعارات"},
en:{title:"Supervisor Dashboard",nav:{agents:"Agents",map:"Map",reports:"Reports",noti:"Notifications"},agents:"Agents Monitoring",map:"Agents Map",reports:"Review Reports",noti:"Notifications"}
};

function toggleLang(){
lang=lang==="ar"?"en":"ar";
document.documentElement.lang=lang;
document.documentElement.dir=lang==="ar"?"rtl":"ltr";
document.getElementById("title").innerText=texts[lang].title;
document.getElementById("navAgents").innerText=texts[lang].nav.agents;
document.getElementById("navMap").innerText=texts[lang].nav.map;
document.getElementById("navReports").innerText=texts[lang].nav.reports;
document.getElementById("navNoti").innerText=texts[lang].nav.noti;
document.getElementById("agentsTitle").innerText=texts[lang].agents;
document.getElementById("mapTitle").innerText=texts[lang].map;
document.getElementById("reportsTitle").innerText=texts[lang].reports;
document.getElementById("notiTitle").innerText=texts[lang].noti;
}

function showSection(section){
document.querySelectorAll(".card").forEach(c=>c.style.display="none");
document.getElementById(section).style.display="block";
}

async function loadAgents(){
const {data,error}=await supabase.from("users").select("*").eq("role","agent");
const tbody=document.getElementById("agentsList"); tbody.innerHTML="";
if(data){data.forEach(u=>{const tr=document.createElement("tr"); tr.innerHTML=`<td>${u.name}</td><td>${u.location}</td><td>${u.task_count||0}</td><td>${u.status||"نشط"}</td>`; tbody.appendChild(tr);});}
}

async function loadReports(){
const {data}=await supabase.from("reports").select("*");
const tbody=document.getElementById("reportsList"); tbody.innerHTML="";
if(data) data.forEach(r=>{const tr=document.createElement("tr"); tr.innerHTML=`<td>${r.agent_name}</td><td>${r.notes}</td><td>${new Date(r.date).toLocaleDateString()}</td>`; tbody.appendChild(tr);});
}

async function loadNotifications(){
const {data}=await supabase.from("notifications").select("*");
const ul=document.getElementById("notiList"); ul.innerHTML="";
if(data) data.forEach(n=>{const li=document.createElement("li"); li.innerText=n.message; ul.appendChild(li);});
}

// تحميل البيانات عند فتح الصفحة
loadAgents(); loadReports(); loadNotifications();
</script>
</body>
</html>
